<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片轮播展示</title>
    <style>
        /**
         * Yzavoku 图片轮播样式表
         * 包含主幻灯片和缩略图轮播的样式定义
         * 支持响应式设计，适配移动端
         */

        /* 导入DM Mono字体 - 用于标题和界面文字 */
        @import url("https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&display=swap");

        /* 全局重置样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* 基础字体设置 */
        body {
            font-family: "DM Mono";
            overflow: hidden;
        }

        /* 图片基础样式 - 确保图片填满容器并保持比例 */
        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /**
         * 主幻灯片容器
         * 全屏固定定位，隐藏溢出内容
         */
        .slider {
            position: fixed;
            width: 100vw;
            height: 100svh;  /* 使用svh单位确保移动端兼容性 */
            overflow: hidden;
        }

        /**
         * 单个幻灯片项
         * 绝对定位，占视口宽度的45%
         */
        .slide {
            position: absolute;
            width: 45vw;
            height: 100svh;
            overflow: hidden;
        }

        /**
         * 幻灯片标题
         * 居中定位在幻灯片中心，黑色背景白色文字
         * 使用transform实现精确居中
         */
        .slide-title {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);  /* 精确居中 */
            color: #fff;
            text-align: center;
            text-transform: uppercase;  /* 大写字母 */
            font-size: 0.8rem;
            font-weight: 500;
            line-height: 1;
            background-color: #000;
            padding: 0.2rem 0.4rem;
            pointer-events: none;  /* 不响应鼠标事件 */
            z-index: 0;  /* 2能确保在最上层显示，目前设置为0隐藏 */
        }

        /**
         * 缩略图轮播容器
         * 全屏固定定位，位于幻灯片下层
         */
        .thumbnail-wheel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100svh;
            pointer-events: none;  /* 不响应鼠标事件 */
            z-index: 1;  /* 位于主幻灯片下方 */
        }

        /**
         * 单个缩略图项
         * 绝对定位，固定尺寸的小图片容器
         */
        .thumbnail-item {
            position: absolute;
            width: 35px;
            height: 50px;
            overflow: hidden;
        }

        /**
         * 移动端响应式设计
         * 当屏幕宽度小于1000px时应用特殊样式
         */
        @media (max-width: 1000px) {
            /* 移动端幻灯片宽度调整为75% */
            .slide {
                width: 75vw;
            }

            /* 移动端缩略图尺寸缩小 */
            .thumbnail-item {
                width: 20px;
                height: 30px;
            }
        }

        /* 加载提示 */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-size: 1.2rem;
            z-index: 1000;
        }

        /* 错误提示 */
        .error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0000;
            font-size: 1rem;
            text-align: center;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <!-- 加载提示 -->
    <div id="loading" class="loading">加载中...</div>
    
    <!-- 错误提示 -->
    <div id="error" class="error" style="display: none;">
        <h3>图片加载失败</h3>
        <p id="error-message"></p>
        <p>请确保图片文件存在于正确的路径</p>
    </div>

    <!-- 主幻灯片容器 -->
    <div id="slider" class="slider"></div>
    
    <!-- 缩略图轮播容器 -->
    <div class="thumbnail-wheel"></div>

    <!-- GSAP动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <script>
        // 图片轮播JavaScript代码
        const slider = document.getElementById("slider");
        const slideTitle = document.querySelector(".slide-title");
        const thumbnailWheel = document.querySelector(".thumbnail-wheel");
        const loading = document.getElementById("loading");
        const error = document.getElementById("error");
        const errorMessage = document.getElementById("error-message");

        // 配置参数 - 幻灯片数量、缩放比例、尺寸计算
        const totalSlides = 20;           // 总幻灯片数量
        const endScale = 5;               // 最大缩放比例
        let slideWidth = window.innerWidth * 0.45;  // 幻灯片宽度（桌面端45%视口宽度）
        let viewportCenter = window.innerWidth / 2; // 视口中心点
        let isMobile = window.innerWidth < 1000;    // 移动端检测

        // 幻灯片标题数组 - 对应20张图片的标题
        const slideTitles = [
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
            "Request in progress",
        ];

        // 动画状态变量 - 位置追踪和滚动状态
        let currentX = 0;        // 当前X轴位置
        let targetX = 0;         // 目标X轴位置
        let isScrolling = false; // 是否正在滚动
        let scrollTimeout;       // 滚动超时定时器
        let activeSlideIndex = 0; // 当前激活的幻灯片索引

        // 图片加载错误处理
        function handleImageError(img, imagePath) {
            console.error(`图片加载失败: ${imagePath}`);
            img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZjBmMGYwIi8+CjxwYXRoIGQ9Ik0yMDAgMTUwTDE3NSAxMjVIMjI1TDIwMCAxNTBaIiBmaWxsPSIjY2NjIi8+Cjx0ZXh0IHg9IjIwMCIgeT0iMTgwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjOTk5IiBmb250LXNpemU9IjE0Ij7lvLrpn7PotKHkuJo8L3RleHQ+Cjwvc3ZnPgo=';
            img.alt = '图片加载失败';
        }

        /**
         * 创建幻灯片元素
         * 生成3倍数量的幻灯片用于无缝循环滚动
         */
        function createSlides() {
            let loadedImages = 0;
            let totalImages = totalSlides * 3;

            for (let i = 0; i < totalImages; i++) {
                const slide = document.createElement("div");
                slide.className = "slide";

                const img = document.createElement("img");
                const imageNumber = (i % totalSlides) + 1;  // 循环使用1-20的图片
                
                // 尝试多个图片路径
                const imagePaths = [
                    `./slide/1 (${imageNumber}).jpg`,
                    `https://cdn.jsdelivr.net/gh/your-username/your-repo/slide/1 (${imageNumber}).jpg`,
                    `https://raw.githubusercontent.com/your-username/your-repo/main/slide/1 (${imageNumber}).jpg`
                ];

                img.onload = function() {
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        loading.style.display = 'none';
                    }
                };

                img.onerror = function() {
                    handleImageError(img, imagePaths[0]);
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        loading.style.display = 'none';
                    }
                };

                img.src = imagePaths[0]; // 首先尝试本地路径
                slide.appendChild(img);
                slider.appendChild(slide);
            }
        }

        /**
         * 初始化滑块位置
         * 设置所有幻灯片的初始位置，居中显示第一张
         */
        function initializeSlider() {
            const slides = document.querySelectorAll(".slide");

            slides.forEach((slide, index) => {
                const x = index * slideWidth - slideWidth;  // 每张幻灯片间隔slideWidth像素
                gsap.set(slide, { x: x });  // 使用GSAP设置初始位置
            });

            // 计算居中对齐的偏移量
            const centerOffset = window.innerWidth / 2 - slideWidth / 2;
            currentX = centerOffset;  // 设置当前位置
            targetX = centerOffset;   // 设置目标位置
        }

        createSlides();
        initializeSlider();

        /**
         * 处理鼠标滚轮事件
         * @param {Event} e - 滚轮事件对象
         */
        function handleScroll(e) {
            const scrollIntensity = e.deltaY || e.detail || e.wheelDelta * -1;  // 获取滚动强度
            targetX -= scrollIntensity * 1;  // 根据滚动方向调整目标位置

            isScrolling = true;  // 设置滚动状态
            clearTimeout(scrollTimeout);  // 清除之前的超时

            // 设置滚动结束检测
            scrollTimeout = setTimeout(() => {
                isScrolling = false;  // 150ms后认为滚动结束
            }, 150);
        }

        /**
         * 主动画循环函数
         * 处理幻灯片位置更新和无限循环滚动
         */
        function animate() {
            currentX += (targetX - currentX) * 0.1;  // 平滑缓动到目标位置

            const totalWidth = totalSlides * slideWidth;  // 总宽度
            
            // 实现无限循环滚动 - 当超出边界时重置位置
            if (currentX > 0) {
                currentX -= totalWidth;  // 向左超出时重置到右侧
                targetX -= totalWidth;
            } else if (currentX < -totalWidth) {
                currentX += totalWidth;  // 向右超出时重置到左侧
                targetX += totalWidth;
            }

            const slides = document.querySelectorAll(".slide");
            slides.forEach((slide, index) => {
                const x = index * slideWidth + currentX;  // 计算每张幻灯片的位置
                gsap.set(slide, { x: x });  // 使用GSAP设置位置
            });

            requestAnimationFrame(animate);  // 继续下一帧动画
        }

        /**
         * 事件监听器初始化
         * 设置滚轮事件和滚动行为控制
         */

        // 添加滚轮事件监听器 - 支持标准滚轮和Firefox DOMMouseScroll
        window.addEventListener("wheel", handleScroll, { passive: false });
        window.addEventListener("DOMMouseScroll", handleScroll, { passive: false });

        // 阻止页面默认滚动行为 - 保持滑块在视口内
        window.addEventListener(
            "scroll",
            function (e) {
                if (e.target === document || e.target === document.body) {
                    window.scrollTo(0, 0);  // 重置滚动位置到顶部
                }
            },
            { passive: false }
        );

        // 启动动画循环
        animate();

        /**
         * 窗口大小调整处理
         * 当窗口大小改变时重新计算尺寸和重新初始化
         */
        window.addEventListener('resize', () => {
            // 重新计算尺寸参数
            slideWidth = window.innerWidth * 0.45;
            viewportCenter = window.innerWidth / 2;
            isMobile = window.innerWidth < 1000;
            
            // 重新初始化滑块和缩略图
            initializeSlider();
        });

        /**
         * 增强版动画循环函数（带缩放效果和标题更新）
         * 处理幻灯片位置、缩放动画、透视效果和标题更新
         */
        function animate() {
            currentX += (targetX - currentX) * 0.1;  // 平滑缓动到目标位置

            const totalWidth = totalSlides * slideWidth;  // 总宽度
            
            // 实现无限循环滚动 - 当超出边界时重置位置
            if (currentX > 0) {
                currentX -= totalWidth;  // 向左超出时重置到右侧
                targetX -= totalWidth;
            } else if (currentX < -totalWidth) {
                currentX += totalWidth;  // 向右超出时重置到左侧
                targetX += totalWidth;
            }

            let centerSlideIndex = 0;  // 最靠近中心的幻灯片索引
            let closestToCenter = Infinity;  // 最小距离记录
            
            const slides = document.querySelectorAll(".slide");

            slides.forEach((slide, index) => {
                const x = index * slideWidth + currentX;  // 计算幻灯片位置
                gsap.set(slide, { x: x });  // 设置位置

                // 计算缩放效果 - 基于与视口中心的距离
                const slideCenterX = x + slideWidth / 2;  // 幻灯片中心点
                const distanceFromCenter = Math.abs(slideCenterX - viewportCenter);  // 与视口中心的距离

                const outerDistance = slideWidth * 3;  // 影响范围
                const progress = Math.min(distanceFromCenter / outerDistance, 1);  // 计算进度（0-1）

                // 使用缓动函数使缩放更自然
                const easedProgress =
                progress < 0.5
                    ? 4 * progress * progress * progress
                    : 1 - Math.pow(-2 * progress + 2, 3) / 2;

                const scale = 1 + (endScale - 1) * (1 - easedProgress);  // 计算缩放值
                const opacity = 1 - easedProgress * 0.3;  // 计算透明度

                gsap.set(slide, { scale: scale, opacity: opacity });  // 应用缩放和透明度

                // 跟踪最靠近中心的幻灯片
                if (distanceFromCenter < closestToCenter) {
                    closestToCenter = distanceFromCenter;
                    centerSlideIndex = index % totalSlides;  // 取模获取实际索引
                }
            });

            // 更新标题显示
            if (slideTitle) {
                slideTitle.textContent = slideTitles[centerSlideIndex];
            }

            requestAnimationFrame(animate);  // 继续下一帧动画
        }

        // 启动增强版动画循环
        animate();

        // 键盘控制支持
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowLeft':
                    targetX += slideWidth * 0.5;
                    break;
                case 'ArrowRight':
                    targetX -= slideWidth * 0.5;
                    break;
                case ' ':
                    e.preventDefault();
                    targetX -= slideWidth;
                    break;
            }
        });

        // 触摸控制支持（移动端）
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        });

        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touchX = e.touches[0].clientX;
            const deltaX = touchStartX - touchX;
            targetX -= deltaX * 0.5;
            touchStartX = touchX;
        });

        console.log('图片轮播已初始化完成！');
        console.log('使用说明：');
        console.log('- 鼠标滚轮：左右滚动切换图片');
        console.log('- 键盘方向键：左右箭头切换图片');
        console.log('- 空格键：下一张图片');
        console.log('- 触摸滑动：移动端支持触摸滑动');
    </script>
</body>

</html>
